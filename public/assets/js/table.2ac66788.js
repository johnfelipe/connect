import{S as $,_ as R}from"./app.e5c25aad.js";import{b as y,i as O,d as F,j as b,k as L,p as P,g as C,l as I,m as S,n as w,a as D}from"./header.31500a75.js";import{m as q,i as T}from"./vendor/vendor-core.b127d6f1.js";import{E as d}from"./event-bus.fa2a0358.js";import{g as B}from"./vendor/vendor-bootstrap-vue.8cf54841.js";const H={components:{BTable:B},data(){return{uuid:null,entity:null,fields:[],preRequisite:{},preRequisiteFetchList:[],showFilters:!1,isInitialized:!1,isLoading:!1,isFetching:!1,noMoreData:!1,getInitialDataCalled:!1,gotError:!1,selectedRows:[],formErrors:{},customFilters:{},filtersCastBoolean:[],appendToQuery:{},filtersOptions:{name:""},sortOptions:{hasScroll:!1},columnsOptions:{hasScroll:!1},exportOptions:{},initUrl:"",initSubUrl:null,dataType:null,tagsUrl:"/tags",printOptions:null,headerButtons:null,headerFloaters:null,headerLinks:null,hideHeaderLinks:!1,hideSortOptions:!1,hideColumnOptions:!1,hideFilterButton:!1,feedTable:!1}},computed:{...q("common",["entities","feed","filters","columns","others"]),...q("config",["configs","uiConfigs","vars","allowExtraInput"]),...q("user",["hasRole","hasPermission","hasAnyPermission","profile"]),isFiltered(){const t=this.$route.query;return t.filtered==="true"||t.filtered===!0?!0:t.filtered==="false"||t.filtered===!1?!1:t.filtered},selectAllRows:{get:function(){return this.entities&&this.entities.data.every(({uuid:t})=>this.selectedRows.indexOf(t)!==-1)},set:function(t){let e=this.selectedRows;t?this.entities.data.forEach(i=>{e.indexOf(i.uuid)===-1&&e.push(i.uuid)}):this.entities.data.forEach(i=>{const s=e.indexOf(i.uuid);s!==-1&&e.splice(s,1)}),this.selectedRows=e}},showTagsForm(){return!!this.selectedRows.length},tableMeta(){if(this.uiConfigs.hideSecureContent&&this.filterFn&&_.isFunction(this.filterFn)){let t=this.entities.data.filter(this.filterFn);return t=t.length,{...this.entities.meta,to:this.entities.meta.to-t,total:this.entities.meta.total-t}}return this.entities.meta}},watch:{$route(t,e){this.initSubUrl&&this.$route.params.uuid&&t.params.uuid!==e.params.uuid?(this.doInit(),this.getEntityData()):(this.updatePageMeta(),this.applyPageHeader())},columns(t,e){t.fields&&(this.fields=t.fields,this.$refs&&this.$refs.hasOwnProperty("btable")&&this.$refs.btable&&this.$refs.btable.refresh())}},methods:{...T("common",["Init","InitSub","Get","GetList","GetFeed","Destroy","Update","SetMeta","SetFilters","Custom","GetPreRequisite","ResetFilters","SetPageHeader"]),...T("config",["SetUiConfig","SetConfig"]),itemsProvider(t){this.isLoading=!0;const e={...this.filters,currentPage:this.entities.meta.currentPage,perPage:this.entities.meta.perPage,...this.appendToQuery,sortBy:this.filters.sortBy?this.filters.sortBy.snakeCase():this.filters.sortBy};return this.gotError=!1,this.GetList(e).then(i=>i.data).catch(i=>(this.isLoading=!1,formUtil.handleErrors(i),this.gotError=!0,[]))},getFeed:_.debounce(function(t,e=!1){if(!this.feedTable||this.noMoreData)return;this.isFetching=!0;const i={...this.filters,perPage:this.feed.meta.perPage,cursor:e||(this.feed.meta.cursor?this.feed.meta.cursor:!0),...this.appendToQuery,sortBy:this.filters.sortBy?this.filters.sortBy.snakeCase():this.filters.sortBy};return this.gotError=!1,this.GetFeed(i).then(s=>(s.meta&&s.meta.hasMorePages&&s.data&&s.data.length?this.noMoreData=!1:this.noMoreData=!0,this.isInitialized=!0,this.isFetching=!1,this.isLoading=!1,s.data)).catch(s=>(this.noMoreData=!1,this.isInitialized=!0,this.isFetching=!1,this.isLoading=!1,formUtil.handleErrors(s),this.gotError=!0,[]))},100),updatePageMeta(t=!0,e=!1){const i=this.$route.query,s={currentPage:parseInt(i.currentPage||1),perPage:parseInt(i.perPage||this.configs.system.perPage),cursor:i.cursor||this.entities.meta.cursor||!0};let n=this.filters;i.objForEach((r,p)=>{n[p]=r}),this.filtersCastBoolean&&this.filtersCastBoolean.length&&this.filtersCastBoolean.objForEach(r=>{n[r]=n[r]==="true"?!0:n[r]==="false"?!1:n[r]}),this.customFilters&&this.customFilters.objForEach((r,p)=>{n[p]=r}),this.SetMeta(s),this.SetFilters(n),t?this.isInitialized?(this.refreshTable(),this.isInitialized=!0):this.isInitialized=!0:e&&this.refreshTable()},refreshTable(){this.$refs&&this.$refs.hasOwnProperty("btable")&&this.$refs.btable?(this.$refs.btable.refresh(),console.log("Refreshing table")):(console.log("Refreshing feed"),this.getFeed(null,!0))},refreshTableIfRoute(t){this.$route.name===t?(this.refreshTable(),console.log("Refreshing table")):(console.log("Refreshing feed"),this.getFeed(null,!0))},toggleFilter(){this.showFilters=!this.showFilters},deleteEntity(t){formUtil.confirmAction().then(e=>{e.value?(this.isLoading=!0,this.Destroy(t).then(i=>{this.isLoading=!1,this.$toasted.success(i.message,this.$toastConfig),this.$nextTick(()=>{this.refreshTable(),typeof this.getInitialData=="function"&&this.getInitialDataCalled&&this.getInitialDataCalledAfterDeleting&&this.getInitialData()})}).catch(i=>{this.isLoading=!1,this.isInitialized=!0,this.formErrors=formUtil.handleErrors(i)})):(e.dismiss,$.DismissReason.cancel)})},fillFilterPreRequisite(){!(this.isFiltered&&this.filters&&this.preRequisiteFetchList&&this.preRequisiteFetchList.length)||this.preRequisiteFetchList.forEach(t=>{t.filterKey&&t.preRequisiteKey&&t.url&&this.Custom({url:t.url+this.filters[t.filterKey],method:"get"}).then(e=>{e&&this.preRequisite[t.preRequisiteKey].push(e)})})},fillPreRequisite(t){this.preRequisite.objForEach((e,i)=>{this.preRequisite[i]=t.hasOwnProperty(i)?t[i]:e}),this.isLoading=!1},async getInitialData(){this.isLoading=!0,this.getInitialDataCalled=!0;try{const t=this.$route.query;let e={};this.isFiltered&&t&&this.preRequisiteFetchList&&this.preRequisiteFetchList.length&&this.preRequisiteFetchList.forEach(s=>{s.filterKey&&t[s.filterKey]&&(e[s.filterKey]=t[s.filterKey])});const i=await this.GetPreRequisite({...this.customFilters,...e});return this.fillPreRequisite(i),this.updatePageMeta(),this.fillFilterPreRequisite(),typeof this.afterGetInitialData=="function"&&this.afterGetInitialData(),i}catch(t){throw this.isLoading=!1,this.formErrors=formUtil.handleErrors(t),t}},getEntityData(t){if(this.isLoading=!0,this.initSubUrl&&this.$route.params.uuid)return this.uuid=this.$route.params.uuid,this.Get({uuid:this.uuid}).then(e=>{this.entity=e,e.name&&(this.pageTitle=e.name,this.subTitle=e.name?this.subTitle:"",this.applyPageHeader()),this.doInitSub(),this.updatePageMeta(),this.isLoading=!1,this.afterGetEntityData&&typeof this.afterGetEntityData=="function"&&this.afterGetEntityData(),t&&typeof t=="function"&&t()}).catch(e=>{this.isLoading=!1,formUtil.handleErrors(e),this.$router.back()});this.isLoading=!1,this.$router.back()},reloadEntityData(t){if(this.isLoading=!0,this.initSubUrl&&this.$route.params.uuid)return this.uuid=this.$route.params.uuid,this.Get({uuid:this.uuid}).then(e=>{this.entity=e,e.name&&(this.pageTitle=e.name,this.subTitle=e.name?this.subTitle:"",this.applyPageHeader()),this.isLoading=!1,t&&typeof t=="function"&&t()}).catch(e=>{this.isLoading=!1,formUtil.handleErrors(e),this.$router.back()});this.isLoading=!1,this.$router.back()},applyTags(t){this.Custom({url:this.tagsUrl,method:"post",data:{...t,type:(this.tagType||this.dataType).kebabCase(),uuids:this.selectedRows}}).then(e=>{this.selectedRows=[],this.$toasted.success(e.message,this.$toastConfig),this.refreshAfterTagsApplied&&this.$nextTick(()=>{this.refreshTable()}),this.isLoading=!1}).catch(e=>{this.isLoading=!1,this.formErrors=formUtil.handleErrors(e)})},getSortOptionsArray(){return this.fields.filter(t=>t.sort).map(t=>({label:t.label,sort:t.sort,thClass:t.thClass,tdClass:t.tdClass}))},getHeaderOptions(){let t=[];this.routesRequired&&this.routesRequired.add&&(typeof this.permissionsRequired=="object"&&this.permissionsRequired!==null&&this.permissionsRequired.add?t.push(y(this.routesRequired.add,this.permissionsRequired.add)):this.permissionsRequired?t.push(y(this.routesRequired.add,this.permissionsRequired)):t.push(y(this.routesRequired.add))),this.hideFilterButton||t.push(O()),this.routesRequired&&this.routesRequired.config&&(typeof this.permissionsRequired=="object"&&this.permissionsRequired!==null&&this.permissionsRequired.config?t.push(F(this.routesRequired.config,this.permissionsRequired.config)):this.permissionsRequired?t.push(F(this.routesRequired.config,this.permissionsRequired)):t.push(F(this.routesRequired.config))),this.headerButtons&&(t=t.concat(this.headerButtons));let e=[];this.headerFloaters&&(headerFloaters=headerFloaters.concat(this.headerFloaters));let i=[];return this.routesRequired&&this.routesRequired.import&&(typeof this.permissionsRequired=="object"&&this.permissionsRequired!==null&&this.permissionsRequired.import?i.push(b(this.routesRequired.import,this.permissionsRequired.import)):this.permissionsRequired&&i.push(b(this.routesRequired.import,this.permissionsRequired))),this.routesRequired&&this.routesRequired.config&&(typeof this.permissionsRequired=="object"&&this.permissionsRequired!==null&&this.permissionsRequired.config?i.push(L(this.routesRequired.config,this.permissionsRequired.config)):this.permissionsRequired&&i.push(L(this.routesRequired.config,this.permissionsRequired))),this.headerLinks&&(i=i.concat(this.headerLinks)),this.feedTable||(i.push(P()),i.push(C()),i.push(I()),i.push(S())),{hideLinks:this.hideHeaderLinks||!1,buttons:t,floaters:e,sort:this.hideSortOptions?!1:w(this.sortOptions||{},this.getSortOptionsArray()),links:i,columns:this.hideColumnOptions?!1:this.columnsOptions,title:this.pageTitle||"",subTitle:this.pageTitle&&this.subTitle||""}},getKeyBindingOptions(){let t={...D};return this.routesRequired&&this.routesRequired.add&&(t.key_a=this.routesRequired.add),t},applyPageHeader(){let t=Object.assign({},this.getHeaderOptions(),this.header||{}),e=Object.assign({},this.getKeyBindingOptions(),this.keyBindings||{});this.SetPageHeader(t),this.SetConfig({keyBindings:e})},async export(t){this.isLoading=!0;const e=await R(()=>import("./helpers/transformers.633d09cc.js"),["assets/js/helpers/transformers.633d09cc.js","assets/js/app.e5c25aad.js","assets/js/vendor/vendor-core.b127d6f1.js","assets/js/vendor/vendor-others.8d770de0.js","assets/js/vendor/vendor-essential.41987d0e.js","assets/js/vendor/vendor-bootstrap-vue.8cf54841.js","assets/js/vendor/vendor-vue-gtag.e72bb2d4.js","assets/css/app.css"]),i=(h,l)=>{let u;const a=l.split(".");return a&&a.length?a.forEach((o,f)=>{u=u?u[o]:f===0?h[o]:null}):u=h[l],u};let s,n=this.exportOptions||{},r=this.exportPdfFields||this.fields.filter(h=>(h.label||h.headerTitle)&&!h.cantExport);if(this.uiConfigs.hideSecureContent){const h=new RegExp("secure-content","igm");r=r.filter(l=>!h.test(l.thClass)&&!h.test(l.tdClass))}let p=[],g="",m=moment().unix();if(this.$route.meta.title&&(g=this.$route.meta.trans?$t(this.$route.meta.trans,{attribute:$t(this.$route.meta.title)}):$t(this.$route.meta.title),m=g.toLowerCase().replace(/\s+/g,"-")+"-"+m),t.type==="xls-csv"&&(t.type="csv"),t.type==="pdf"||t.type==="print"){s=await R(()=>import("./helpers/export/pdf.8baf61a4.js"),["assets/js/helpers/export/pdf.8baf61a4.js","assets/js/app.e5c25aad.js","assets/js/vendor/vendor-core.b127d6f1.js","assets/js/vendor/vendor-others.8d770de0.js","assets/js/vendor/vendor-essential.41987d0e.js","assets/js/vendor/vendor-bootstrap-vue.8cf54841.js","assets/js/vendor/vendor-vue-gtag.e72bb2d4.js","assets/css/app.css"]);const h=r.map(l=>({header:l.label||l.headerTitle,dataKey:l.key}));p=this.entities.data.map(l=>{let u={};return r.forEach(a=>{let o=a.transformer,f=i(l,a.key);o&&(f||f===!1)&&(o=_.isArray(o)?o:[o],o.forEach(c=>{const E=_.isFunction(c)?c:e[c];f=a.transformerOpts?E(f,a.transformerOpts):E(f,l)})),u[a.key]=f||""}),u}),t.type==="pdf"?s.downloadPdfFile(m,g,h,p,n):s.printTable(g,h,p,n)}else s=await R(()=>import("./helpers/export/csv.a61554a1.js"),["assets/js/helpers/export/csv.a61554a1.js","assets/js/vendor/vendor-export-from-json.35fe6e33.js"]),p=this.entities.data.map(h=>{let l={};return r.forEach(u=>{let a=u.transformer,o=i(h,u.key);a&&(o||o===!1)&&(a=_.isArray(a)?a:[a],a.forEach(f=>{const c=_.isFunction(f)?f:e[f];o=u.transformerOpts?c(o,u.transformerOpts):c(o,h)})),l[u.label]=o||""}),l}),s.downloadFile(p,t.type,m);this.isLoading=!1},doInitSub(){this.uuid=this.$route.params.uuid,this.uuid||(this.isLoading=!1,this.$router.back()),this.InitSub({url:this.uuid+"/"+this.initSubUrl,filters:this.filtersOptions,columns:this.fields})},doInit(){this.Init({url:this.initUrl,filters:this.filtersOptions,columns:this.fields}),this.applyPageHeader()},clearFilters(){let t=!1;this.noMoreData=!1,this.filtersOptions.objForEach((e,i)=>{e!==""&&(t=!0)}),t?(this.ResetFilters(),this.SetFilters({...this.filters,...this.filtersOptions})):this.ResetFilters(),this.$route.query&&this.$route.query.filtered&&this.$router.push({path:this.$route.path}).catch(e=>{}),this.afterClearFilters&&_.isFunction(this.afterClearFilters)&&this.afterClearFilters()},rowClickHandler(t,e){if(t.action&&typeof t.action=="function")t.action(t,e);else if(t.route)this.$router.push({name:t.route,params:{uuid:e.uuid}});else if(t.getRoute&&_.isFunction(t.getRoute)){const i=t.getRoute(e);i&&this.$router.push({name:i,params:{uuid:e.uuid}})}},getBalanceClass(t){let e=t>0?"text-success":"text-danger";return e=t&&Number(t)!=0?e:"text-muted",e=e+" font-weight-600",e},getPopoverContent(t,e="list",i,s="name",n){if(e==="list"&&i&&s){let r=this.getDetailsList(t[i],s);return r=`<ul>${r.join()}</ul>`,r}else if(e==="custom"&&n&&typeof n=="function")return n(t)},getDetailsList(t,e){return t.map(i=>`<li>${i[e]}</li>`)},momentFn(t,e,i){return moment(t,e||this.vars.serverDateFormat).format(i||this.vars.defaultDateFormat)}},mounted(){d.$off("REFRESH_TABLE",this.refreshTableIfRoute),d.$on("REFRESH_TABLE",this.refreshTableIfRoute),d.$off("TOGGLE_FILTER",this.toggleFilter),d.$on("TOGGLE_FILTER",this.toggleFilter),d.$off("CLEAR_FILTERS",this.clearFilters),d.$on("CLEAR_FILTERS",this.clearFilters),d.$off("EXPORT",this.export),d.$on("EXPORT",this.export),this.isFiltered&&window.setTimeout(()=>{this.showFilters=!0},1e3),this.doInit()},destroyed(){d.$off("REFRESH_TABLE",this.refreshTableIfRoute),d.$off("TOGGLE_FILTER",this.toggleFilter),d.$off("CLEAR_FILTERS",this.clearFilters),d.$off("EXPORT",this.export)}};export{H as t};
